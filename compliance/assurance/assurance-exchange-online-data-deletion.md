---
title: Microsoft 365 Exchange Online のデータ削除
description: メールボックスおよびメールボックス内のアイテムに対するソフト データとハード データの削除が Exchange Online でどのように処理されるのかについて説明します。
ms.author: robmazz
author: robmazz
manager: laurawi
ms.reviewer: sosstah
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
- MS-Compliance
f1.keywords:
- NOCSH
ms.custom: seo-marvel-apr2020
titleSuffix: Microsoft Service Assurance
ms.openlocfilehash: b86c855a113706731ac6037a2851ae0f1adaccb9
ms.sourcegitcommit: b06fa9f1b230fd5e470817486ea51f460f28b691
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/27/2021
ms.locfileid: "50012963"
---
# <a name="exchange-online-data-deletion-in-microsoft-365"></a>Microsoft 365 での Exchange Online データの削除

Exchange Online では、削除にはソフト削除とハード削除の 2 種類があります。 これは、メールボックスとメールボックス内のアイテムの両方に適用されます。

## <a name="soft-deleted-and-hard-deleted-mailboxes"></a>回復して削除されたメールボックスとハード削除されたメールボックス

回復可能な削除によって削除されたユーザー メールボックスとは、Microsoft 365 管理センターまたは Remove-Mailbox コマンドレットを使用して削除され、Azure Active Directory のごみ箱に 30 日未満残っているメールボックスです。 メールボックスは、次の方法で回復可能な削除によって削除されます。

- ユーザー メールボックスに関連付けられている Azure Active Directory ユーザー アカウントが回復可能な削除によって削除されている (ユーザー オブジェクトがスコープ外またはごみ箱コンテナー内にある)。
- ユーザー メールボックスに関連付けられている Azure Active Directory ユーザー アカウントがハード削除されましたが、Exchange Online メールボックスは訴訟ホールドまたは電子情報開示ホールドの対象になります。
- ユーザー メールボックスに関連付けられている Azure Active Directory ユーザー アカウントは、過去 30 日以内に削除されました。これは、Exchange Online がメールボックスを完全に削除して回復不能にされる前に、回復可能な削除によって削除された状態で保持する最大保持期間です。

ハード削除されたユーザー メールボックスは、次のいずれかの方法で削除されたメールボックスです。

- ユーザー メールボックスが 30 日以上回復可能な削除によって削除され、関連付けられた Azure Active Directory ユーザーが削除されました。 メール、連絡先、ファイルなどのメールボックスの内容はすべて完全に削除されます。
- ユーザー メールボックスに関連付けられているユーザー アカウントが Azure Active Directory からハード削除されました。 ユーザー メールボックスが Exchange Online で回復可能な削除によって削除され、回復可能な削除によって削除された状態が 30 日間保持されます。 30 日間の期間に、新しい Azure Active Directory ユーザーが同じ **ExchangeGuid** または **ArchiveGuid** を使用して元の受信者アカウントから同期され、その新しいアカウントが Exchange Online のライセンスを取得している場合、元のユーザー メールボックスがハード削除されます。 メール、連絡先、ファイルなどのメールボックスの内容はすべて完全に削除されます。
- 回復可能な削除によって削除されたメールボックスは **、Remove-Mailbox -PermanentlyDelete を使用して削除されます**。

上記の削除シナリオでは、ユーザーメールボックスが訴訟ホールドや電子情報開示の保留など、どの保持状態にも含めなかったと想定しています。 メールボックスに何か種類のホールドがある場合、メールボックスを削除することはできません。 すべてのメール ユーザー受信者の種類に対[](https://support.office.com/article/manage-legal-investigations-in-office-365-2e5fbe9f-ee4d-4178-8ff8-4356bc1b168e?ui=en-US&rs=en-US&ad=US)して、保持設定は無視され、ハード削除やソフト削除には影響しません。

## <a name="soft-deleted-and-hard-deleted-items"></a>削除済みアイテムと削除済みアイテム (回復)、およびハード削除済みアイテム

ユーザーがメールボックス アイテム (電子メール メッセージ、連絡先、予定表の予定、タスクなど) を削除すると、アイテムは [回復可能なアイテム] フォルダーに移動され、[削除] という名前のサブフォルダーに移動されます。 これは、ソフト削除と呼ばれます。 削除したアイテムが [削除] フォルダーに保持される期間は、メールボックスに設定された 削除済アイテムの保持期間によって決まります。 Exchange Online メールボックスは削除済みアイテムを既定で 14 日間保持しますが、Exchange Online 管理者は、この設定を変更して最大 30 日間の期間を増やします。 (Exchange Online メールボックスの削除済みアイテムの保持期間を長くする詳細な手順については [、「Exchange Online](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/change-deleted-item-retention)メールボックスの完全に削除されたアイテムを保持する期間を変更する」を参照してください)。ユーザーは、削除済みアイテムの保持期間が経過する前に、削除済みアイテムを回復または削除できます。 これを行うには、Microsoft Outlook または Outlook on the web の削除済みアイテムの復元機能を使用します。

ユーザーが Outlook または Outlook on the web の削除済みアイテムの復元機能を使用して削除済みアイテムを削除した場合、これはハード削除と呼ばれる機能です。 Exchange Online では、新しいメールボックスの作成時に単一アイテムの回復が既定で有効になっている[](https://docs.microsoft.com/Exchange/recipients/user-mailboxes/recover-deleted-messages)ので、管理者は削除済みアイテムの保存期間が経過する前に、引き続きハード削除されたアイテムを回復できます。 また、単一アイテムの回復が有効になっていれば、ユーザーまたはプロセスによってメッセージが変更されたときに、元のアイテムのコピーの保存も行われます。

## <a name="page-zeroing"></a>ページのゼロ

*ゼロ化* は、削除されたデータに対してゼロまたはバイナリ パターンのどちらかを書き込み、削除されたデータの回復が困難になるセキュリティ メカニズムです。 Exchange Online では、メールボックスデータベースはページを記憶域の単位として使用し、ページの削除と呼ばれる上書きプロセス *を実装します*。 ページの削除は既定で有効であり、お客様や Microsoft によって無効にすることはできません。 ページの削除操作はトランザクション ログ ファイルに記録され、特定のデータベースのすべてのコピーが同様の方法でページから削除されます。 アクティブ なデータベース コピーでページをゼロに設定すると、そのページはデータベースのパッシブ コピーでゼロになります。

ページの削除では、ハード削除されたレコードに対してバイナリ パターンが書き込まれます。 ページの削除パターンは、Extensible Storage Engine (ESE) 操作 (Exchange Online のサーバーで使用される内部データベース エンジンの名前) に固有のパターンであり、実行時操作とバックグラウンド データベースメンテナンス操作では異なります。 (バックグラウンド データベースメンテナンスは、各データベースのチェックサムを継続的に計算してスキャンするプロセスです。 その主な機能は、データベース ページのチェックサムを計算する機能ですが、スペースのクリーンアップや、ストアのクラッシュのために削除されていないレコードやページの削除も処理します)。

次の表に、特定の実行時操作に対応したパターンを一覧表示します。

| ESE 実行時操作   | パターン |
|--------------------------|--------------|
| 置換                  | R            |
| レコード/長い値の削除 | D            |
| 解放されたページ領域         | H            |

次の表は、ESE バックグラウンド データベース保守で実行される特定の操作に対応したパターンの一覧です。

| ESE バックグラウンド データベース保守操作 | パターン |
|-----------------------------------------------|--------------|
| レコードの削除                                 | D            |
| 長い値の削除                             | L            |
| 部分的に使用されたページの解放されたページ領域       | Z            |
| 未使用ページの解放されたページ領域               | U            |

### <a name="page-zeroing-process"></a>ページの終了処理

ページの消去のプロセスは、削除シナリオによって異なります。 次の表に、データベースの削除のシナリオ、およびページ解放機能が実行される時点について説明します。

| データベースの削除のシナリオ | データベース データを解放するための ESE プロセスと期間 |
|:--------------------------|:------------------------------------------------|
| 削除済みアイテムの保持期間に基づいてアイテムの有効期限が切れます。 | 非同期のスレッドは、バイナリ パターンを削除されたデータに上書きします。 この操作はレコード削除の数ミリ秒以内に実行されます。 非同期のゼロ化作業がまだ未解決の間にストア プロセスがクラッシュした場合 (またはバージョン ストアの増加によりバージョン ストアのクリーンアップが取り消された場合)、バック グラウンド データベースのメンテナンスがデータベースのそのセクションを処理するときに終了します。 |
| View Scenario: Expiration of items from Outlook/Outlook on the web folder view (for example, Conversation view) | バックグラウンド データベース保守でデータベースのこのセクションが処理されたときに、データ解放が実行されます。 |
| メールボックスの移動/メールボックスの削除シナリオ: ソース メールボックスが削除された (削除されたメールボックスの有効期限) | バックグラウンド データベース保守でデータベースのこのセクションが処理されたときに、データ解放が実行されます。 |

### <a name="mailbox-data-types-without-page-zeroing"></a>ページの削除を使用しないメールボックスのデータ型

次のメールボックス のデータ型には、ページの削除の準備はありません。

- **メールボックス データベーストランザクション ログ** - 通常の操作の一部としてトランザクション ログが削除された場合、削除されたログ ファイルを格納したファイル システム内のブロックをゼロにするプロセスはありません。 新しく作成されたログの空き領域は、ファイル システムによってすぐに再使用される可能性がありますが、これが発生する保証はありません。
- **コンテンツ インデックス カタログ ファイル** - Exchange Online は、検索インデックス機能に Search Foundation (FAST とも呼ばれる) を使用します。 検索インデックス カタログは、メールボックス データベース ファイルと同じボリュームに格納された数十のファイルで構成されます。 メッセージがメールボックス データベースから物理的に削除されても、検索カタログ内の関連付けられているコンテンツはすぐには削除されません。 コンテンツの削除は、Search Foundation が多数の小さなカタログ ファイルを 1 つの大きなファイルにシャドウ (またはマスター 結合) する場合に発生します。 マスター結合が完了すると、小さいカタログ ファイルが削除されます。 削除されたカタログ ファイルを格納したブロックを 0 に設定するプロセスはありません。

## <a name="continuous-replication"></a>連続レプリケーション

連続レプリケーション (ログ配布および再生とも呼ばれる) は、高可用性、サイト復元、および障害復旧を提供するために、すべてのメールボックス データベースのコピーを作成および維持する Exchange Online のテクノロジです。 連続レプリケーションは、Exchange Server クラッシュ復旧サポートを使用して、メールボックス データベースの 1 つ以上のコピーの非同期更新を実行するテクノロジを提供します。 各メールボックス サーバーは、アクティブ なデータベースで行われたデータベースの更新 (ユーザーの電子メール アクティビティなど) を、連続した 1 MB のトランザクション ログ ファイルのログ レコードとして記録します。 この一連のファイルは、ログ ストリームと呼ばれます。 連続レプリケーションでは、ログ ストリームはデータベースの 1 つ以上のコピーを非同期的に更新するためにも使用されます。 これを行うには、アクティブ データベースのパッシブ コピーを含む場所にログを送信し、パッシブ データベース コピーに再生します。 アクティブ データベースからのすべてのログがデータベースのパッシブ コピーに対して再生される場合、2 つのデータベースは同等であり、このプロセスを通じて、アクティブ データベースに対して行われた物理的な変更は、そのデータベースのすべてのパッシブ コピーにレプリケートされます。

メールボックス データベースからの削除、メールボックス アイテムまたはメールボックス全体、および回復可能な削除または物理的な削除のかどうかは、アクティブ データベースに対する物理的な変更を表します。 ページの削除では、アクティブ なデータベースに物理的な変更を加える必要があります。 これらの変更は、連続レプリケーションと呼ばれるプロセスを通じてログ ファイルに書き込まれます。これらのログ ファイルがデータベースのパッシブ コピーに対して再生される場合、それらのパッシブ データベースに対して同じ物理的な変更が行されます。
