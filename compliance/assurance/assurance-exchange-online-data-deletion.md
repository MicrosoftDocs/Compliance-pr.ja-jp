---
title: Microsoft 365 Exchange Online データの削除
description: Exchange Online で、メールボックスおよびメールボックス内のアイテムに対するソフト データとハード データの削除がどのように処理されるのかについて説明します。
ms.author: robmazz
author: robmazz
manager: laurawi
ms.reviewer: sosstah
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
- MS-Compliance
f1.keywords:
- NOCSH
ms.custom: seo-marvel-apr2020
titleSuffix: Microsoft Service Assurance
hideEdit: true
ms.openlocfilehash: c88e7359931fb964fbc4cb6531c5151072a50df0
ms.sourcegitcommit: 024137a15ab23d26cac5ec14c36f3577fd8a0cc4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/01/2021
ms.locfileid: "51497200"
---
# <a name="exchange-online-data-deletion-in-microsoft-365"></a>Microsoft 365 での Exchange Online データの削除

Exchange Online では、ソフト削除とハード削除の 2 種類の削除があります。 これは、メールボックスとメールボックス内のアイテムの両方に適用されます。

## <a name="soft-deleted-and-hard-deleted-mailboxes"></a>削除済みメールボックスとハード削除されたメールボックス

ソフト削除されたユーザー メールボックスは、Microsoft 365 管理センターまたは Remove-Mailbox コマンドレットを使用して削除されたメールボックスであり、Azure Active Directory のごみ箱に 30 日未満残っています。 メールボックスは、次の方法でソフト削除される場合があります。

- ユーザー メールボックスに関連付けられた Azure Active Directory ユーザー アカウントは、ソフト削除されます (ユーザー オブジェクトがスコープ外またはごみ箱コンテナー内にあります)。
- ユーザー メールボックスに関連付けられた Azure Active Directory ユーザー アカウントはハード削除されましたが、Exchange Online メールボックスは訴訟ホールドまたは電子情報開示ホールドの下にあります。
- ユーザー メールボックスに関連付けられた Azure Active Directory ユーザー アカウントは、過去 30 日以内に削除されました。これは、Exchange Online がメールボックスを完全に削除して回復不能にする前に、メールボックスを回復可能な状態に保つ最大保持長です。

ハード削除されたユーザー メールボックスは、次のいずれかの方法で削除されたメールボックスです。

- ユーザー メールボックスが 30 日間以上ソフト削除され、関連付けられた Azure Active Directory ユーザーがハード削除されました。 メール、連絡先、ファイルなどのメールボックスのコンテンツはすべて完全に削除されます。
- ユーザー メールボックスに関連付けられたユーザー アカウントが Azure Active Directory からハード削除されました。 これで、ユーザー メールボックスは Exchange Online でソフト削除され、30 日間ソフト削除された状態のままです。 30 日間の間に、新しい Azure Active Directory ユーザーが元の受信者アカウントと同じ **ExchangeGuid** または **ArchiveGuid** で同期され、その新しいアカウントが Exchange Online のライセンスを取得している場合、元のユーザー メールボックスがハード削除されます。 メール、連絡先、ファイルなどのメールボックスのコンテンツはすべて完全に削除されます。
- 削除済みメールボックスは **Remove-Mailbox -PermanentlyDelete を使用して削除されます**。

上記の削除シナリオでは、ユーザー メールボックスが訴訟ホールドや電子情報開示ホールドなど、保持状態に含めなかったと仮定します。 メールボックスに保持の種類がある場合は、メールボックスを削除できません。 すべてのメール ユーザー受信者の種類では、[](https://support.office.com/article/manage-legal-investigations-in-office-365-2e5fbe9f-ee4d-4178-8ff8-4356bc1b168e?ui=en-US&rs=en-US&ad=US)保持設定は無視され、ハード削除やソフト削除には影響しません。

## <a name="soft-deleted-and-hard-deleted-items"></a>削除済みアイテムとハード削除済みアイテム

ユーザーがメールボックス アイテム (電子メール メッセージ、連絡先、予定表の予定、タスクなど) を削除すると、アイテムは [回復可能なアイテム] フォルダーに移動され、"Deletes" という名前のサブフォルダーに移動されます。 これは、ソフト削除と呼ばれます。 削除したアイテムが [削除] フォルダーに保持される期間は、メールボックスに設定された 削除済アイテムの保持期間によって決まります。 Exchange Online メールボックスは削除済みアイテムを既定で 14 日間保持しますが、Exchange Online 管理者は、この設定を変更して最大 30 日間の期間を増やします。 (Exchange Online メールボックスの削除済みアイテム保持期間を長くする詳細な手順については [、「Exchange Online](/exchange/recipients-in-exchange-online/manage-user-mailboxes/change-deleted-item-retention)メールボックスの完全に削除されたアイテムを保持する期間を変更する」を参照してください。ユーザーは、削除済みアイテムの保持時間が経過する前に、削除済みアイテムを回復または削除できます。 これを行うには、Microsoft Outlook または Outlook on the web で削除済みアイテムの回復機能を使用します。

ユーザーが Outlook または Outlook on the web の削除済みアイテムの回復機能を使用して削除済みアイテムを削除した場合、これはハード削除と呼ばれる。 Exchange Online では、新しいメールボックスの作成時に単一アイテムの回復が既定で有効になっている[](/Exchange/recipients/user-mailboxes/recover-deleted-messages)ので、削除済みアイテムの保持期間が経過する前に、管理者は削除済みアイテムを回復できます。 また、単一アイテムの回復が有効になっていれば、ユーザーまたはプロセスによってメッセージが変更されたときに、元のアイテムのコピーの保存も行われます。

## <a name="page-zeroing"></a>ページのゼロ化

*ゼロ化* は、削除されたデータに対してゼロまたはバイナリ パターンを書き込み、削除されたデータの回復が困難になるセキュリティ メカニズムです。 Exchange Online では、メールボックスデータベースはページをストレージの単位として使用し、ページゼロと呼ばれる上書きプロセス *を実装します*。 ページのゼロ設定は既定で有効になっているので、お客様または Microsoft が無効にすることはできません。 ページゼロ操作はトランザクション ログ ファイルに記録され、特定のデータベースのすべてのコピーが同様の方法でページゼロになります。 アクティブなデータベース コピーでページをゼロにすると、データベースのパッシブ コピーでページが 0 になります。

ページゼロは、ハード削除されたレコードに対してバイナリ パターンを書き込みます。 ページゼロパターンは、拡張可能ストレージ エンジン (ESE) 操作 (Exchange Online のサーバーで使用される内部データベース エンジンの名前) に固有であり、実行時の操作とバックグラウンド データベースのメンテナンス操作では異なります。 (バックグラウンド データベースのメンテナンスは、各データベースを継続的にチェックサムおよびスキャンするプロセスです。 主な機能は、データベース ページのチェックサムですが、領域のクリーンアップや、ストアクラッシュのためにゼロにされていないレコードとページのゼロアウトも処理します)。

次の表に、特定の実行時操作に対応したパターンを一覧表示します。

| ESE 実行時操作   | パターン |
|--------------------------|--------------|
| 置換                  | R            |
| レコード/長い値の削除 | D            |
| 解放されたページ領域         | H            |

次の表は、ESE バックグラウンド データベース保守で実行される特定の操作に対応したパターンの一覧です。

| ESE バックグラウンド データベース保守操作 | パターン |
|-----------------------------------------------|--------------|
| レコードの削除                                 | D            |
| 長い値の削除                             | L            |
| 部分的に使用されたページの解放されたページ領域       | Z            |
| 未使用ページの解放されたページ領域               | U            |

### <a name="page-zeroing-process"></a>ページのゼロ化プロセス

ページのゼロ化のプロセスは、削除シナリオによって異なります。 次の表に、データベースの削除のシナリオ、およびページ解放機能が実行される時点について説明します。

| データベースの削除のシナリオ | データベース データを解放するための ESE プロセスと期間 |
|:--------------------------|:------------------------------------------------|
| アイテムの有効期限は、削除されたアイテムの保持期間に基づいて行います。 | 非同期のスレッドは、バイナリ パターンを削除されたデータに上書きします。 この操作はレコード削除の数ミリ秒以内に実行されます。 非同期ゼロ作業がまだ未解決の間にストア プロセスがクラッシュした場合 (またはバージョン ストアの増加によりバージョン ストアのクリーンアップが取り消された場合)、バックグラウンド データベースのメンテナンスがデータベースのそのセクションを処理すると、ゼロが完了します。 |
| シナリオの表示: Web フォルダー ビューの Outlook/Outlook からのアイテムの有効期限 (会話ビューなど) | バックグラウンド データベース保守でデータベースのこのセクションが処理されたときに、データ解放が実行されます。 |
| Move Mailbox/Delete Mailbox Scenario: Source Mailbox deleted (削除済みメールボックスの有効期限) | バックグラウンド データベース保守でデータベースのこのセクションが処理されたときに、データ解放が実行されます。 |

### <a name="mailbox-data-types-without-page-zeroing"></a>ページをゼロにしないメールボックス データ型

次のメールボックス データ型には、ページのゼロ設定の準備はありません。

- **メールボックス データベース トランザクション ログ** - トランザクション ログが通常の操作の一部として削除された場合、削除されたログ ファイルを格納したファイル システム内のブロックをゼロにするプロセスはありません。 ファイル システムは、新しく作成されたログの空き領域をすぐに再使用する可能性がありますが、これが発生する保証はありません。
- **コンテンツ インデックス カタログ ファイル** - Exchange Online は検索インデックス作成機能に Search Foundation (FAST とも呼ばれる) を使用します。 検索インデックス カタログは、メールボックス データベース ファイルと同じボリュームに格納されている数十個のファイルで構成されます。 メッセージがメールボックス データベースから物理的に削除されても、検索カタログ内の関連付けられているコンテンツはすぐには削除されません。 コンテンツの削除は、Search Foundation が多数の小さなカタログ ファイルを 1 つの大きなファイルにシャドウ (またはマスター マージ) する場合に発生します。 マスター結合が完了すると、小さいカタログ ファイルが削除されます。 削除されたカタログ ファイルを格納したブロックをゼロにするプロセスはありません。

## <a name="continuous-replication"></a>継続的レプリケーション

継続的レプリケーション (ログ配布と再生とも呼ばれる) は、高可用性、サイトの復元、および障害復旧を提供するために、すべてのメールボックス データベースのコピーを作成および管理する Exchange Online のテクノロジです。 継続的レプリケーションでは、Exchange Serverクラッシュ復旧サポートを使用して、メールボックス データベースの 1 つ以上のコピーの非同期更新を実行するテクノロジを提供します。 各メールボックス サーバーは、アクティブ なデータベース (ユーザーの電子メール アクティビティなど) で行われたデータベースの更新を、1 MB のトランザクション ログ ファイルの順次セットのログ レコードとして記録します。 この一連のファイルは、ログ ストリームと呼ばれます。 継続的レプリケーションでは、ログ ストリームを使用して、データベースの 1 つ以上のコピーを非同期的に更新します。 これは、アクティブ なデータベースのパッシブ コピーを含む場所にログを送信し、パッシブ データベース コピーに再生することで実現されます。 アクティブ なデータベースのすべてのログがデータベースのパッシブ コピーに対して再生される場合、2 つのデータベースは同等であり、アクティブ なデータベースに対して行われた物理的な変更は、そのデータベースのすべてのパッシブ コピーにレプリケートされます。

メールボックス データベースからの削除は、メールボックス アイテムかメールボックス全体か、および回復可能な削除かハード削除かに関わりなく、アクティブ なデータベースに対する物理的な変更を表します。 ページのゼロ化には、アクティブ なデータベースに物理的な変更を加える必要があります。 これらの変更は、継続的レプリケーションと呼ばれるプロセスを通じてログ ファイルに書き込まれます。また、それらのログ ファイルがデータベースのパッシブ コピーに対して再生される場合は、それらのパッシブ データベースに対して同じ物理的な変更が行います。
