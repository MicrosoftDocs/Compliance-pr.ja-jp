---
title: Microsoft 365 での Exchange Online データの回復性
description: この記事では、Exchange Online および Microsoft 365 内のデータ復元のさまざまな側面について説明します。
ms.author: robmazz
author: robmazz
manager: laurawi
ms.reviewer: sosstah
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
- MS-Compliance
f1.keywords:
- NOCSH
ms.custom: seo-marvel-apr2020
titleSuffix: Microsoft Service Assurance
hideEdit: true
ms.openlocfilehash: 4782cb47bcd5da86daf11f01cb3a443a9b637c49
ms.sourcegitcommit: 024137a15ab23d26cac5ec14c36f3577fd8a0cc4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/01/2021
ms.locfileid: "51497211"
---
# <a name="exchange-online-data-resiliency-in-microsoft-365"></a><span data-ttu-id="d174c-103">Microsoft 365 での Exchange Online データの復元</span><span class="sxs-lookup"><span data-stu-id="d174c-103">Exchange Online data resiliency in Microsoft 365</span></span>

>[!IMPORTANT]
><span data-ttu-id="d174c-104">メールボックス コンテンツを保持するためのさまざまな方法に投資を続ける中で、Exchange Online の exchange 管理センター (EAC) での In-Place Holds の削除を発表します。</span><span class="sxs-lookup"><span data-stu-id="d174c-104">As we continue to invest in different ways to preserve mailbox content, we're announcing the retirement of In-Place Holds in the Exchange admin center (EAC) in Exchange Online.</span></span> <span data-ttu-id="d174c-105">2020 年 7 月 1 日から、新しい保留リストをIn-Placeできます。</span><span class="sxs-lookup"><span data-stu-id="d174c-105">Starting July 1, 2020, you won't be able to create new In-Place Holds.</span></span> <span data-ttu-id="d174c-106">ただし、EAC で、または Exchange Online PowerShell In-Place **Set-MailboxSearch** コマンドレットを使用して、引き続き保留リストを管理できます。</span><span class="sxs-lookup"><span data-stu-id="d174c-106">But you'll still be able to manage In-Place Holds in the EAC or by using the **Set-MailboxSearch** cmdlet in Exchange Online PowerShell.</span></span> <span data-ttu-id="d174c-107">ただし、2020 年 10 月 1 日から、保留の管理In-Placeされます。</span><span class="sxs-lookup"><span data-stu-id="d174c-107">However, starting October 1, 2020, you won't be able to manage In-Place Holds.</span></span> <span data-ttu-id="d174c-108">削除できるのは、EAC または **Remove-MailboxSearch コマンドレットを使用する場合** のみです。</span><span class="sxs-lookup"><span data-stu-id="d174c-108">You'll only be able to remove them in the EAC or by using the **Remove-MailboxSearch** cmdlet.</span></span> <span data-ttu-id="d174c-109">このIn-Place Exchange ハイブリッド展開Exchange Server保持の使用は引き続きサポートされます。</span><span class="sxs-lookup"><span data-stu-id="d174c-109">Using In-Place Holds in Exchange Server and Exchange hybrid deployments will still be supported.</span></span> <span data-ttu-id="d174c-110">Exchange Online での保留リストの削除のIn-Placeについては、「従来の電子情報開示ツールの使用を取り除く [」を参照してください](/microsoft-365/compliance/legacy-ediscovery-retirement)。</span><span class="sxs-lookup"><span data-stu-id="d174c-110">For more information about the retirement of In-Place Holds in Exchange Online, see [Retirement of legacy eDiscovery tools](/microsoft-365/compliance/legacy-ediscovery-retirement).</span></span>

<span data-ttu-id="d174c-111">インプレース保持では、削除済みアイテムと変更されたアイテムの元のバージョンを含む、すべてのメールボックスのコンテンツが保持されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-111">An In-Place Hold preserves all mailbox content, including deleted items and original versions of modified items.</span></span> <span data-ttu-id="d174c-112">[In-Place eDiscovery](/exchange/security-and-compliance/in-place-ediscovery/in-place-ediscovery) 検索で、このようなメールボックスのすべてのアイテムが返されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-112">All such mailbox items are returned in an [In-Place eDiscovery](/exchange/security-and-compliance/in-place-ediscovery/in-place-ediscovery) search.</span></span> <span data-ttu-id="d174c-113">In-Place 保持をユーザーのメールボックスに配置すると、対応するアーカイブ メールボックス内のコンテンツ (有効な場合) も保留にされ、電子情報開示検索で返されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-113">When you place an In-Place Hold on a user's mailbox, the contents in the corresponding archive mailbox (if it's enabled) are also placed on hold and returned in an eDiscovery search.</span></span>

<span data-ttu-id="d174c-114">Exchange データベースに影響を与える可能性のある破損には、通常、ハードウェア (特にストレージ ハードウェア) の問題によって引き起こされる物理的な破損と、他の要因によって発生する論理的な破損の 2 種類があります。</span><span class="sxs-lookup"><span data-stu-id="d174c-114">There are two types of corruption that can affect an Exchange database: physical corruption, which is typically caused by hardware (in particular, storage hardware) problems, and logical corruption, which occurs due to other factors.</span></span> <span data-ttu-id="d174c-115">一般に、Exchange データベース内で発生する可能性がある論理破損には、次の 2 種類があります。</span><span class="sxs-lookup"><span data-stu-id="d174c-115">Generally, there are two types of logical corruption that can occur within an Exchange database:</span></span>

- <span data-ttu-id="d174c-116">**データベースの論理破損** - データベース ページのチェックサムが一致しますが、ページ上のデータが論理的に間違っています。</span><span class="sxs-lookup"><span data-stu-id="d174c-116">**Database logical corruption** - The database page checksum matches, but the data on the page is wrong logically.</span></span> <span data-ttu-id="d174c-117">これは、データベース エンジン (拡張記憶域エンジン (ESE)) がデータベース ページの書き込みを試み、オペレーティング システムが成功メッセージを返しても、データがディスクに書き込まれたり、間違った場所に書き込まれたりしない場合に発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="d174c-117">This can occur when the database engine (the Extensible Storage Engine (ESE)) attempts to write a database page and even though the operating system returns a success message, the data is either never written to the disk or it's written to the wrong place.</span></span> <span data-ttu-id="d174c-118">これは、*ロスト フラッシュ* と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="d174c-118">This is referred to as a *lost flush*.</span></span> <span data-ttu-id="d174c-119">ESE には、データベースの物理的な破損や他のデータ損失のシナリオを防ぐために設計された多数の機能とセーフガードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="d174c-119">ESE includes numerous features and safeguards that are designed to prevent physical corruption of a database and other data loss scenarios.</span></span> <span data-ttu-id="d174c-120">失われたフラッシュがデータを失うのを防ぐため、ESE には、データベースに失われたフラッシュ検出メカニズムと、それを修正する機能 (単一ページの復元) が含まれています。</span><span class="sxs-lookup"><span data-stu-id="d174c-120">To prevent lost flushes from losing data, ESE includes a lost flush detection mechanism in the database along with a feature (single page restore) to correct it.</span></span>
- <span data-ttu-id="d174c-121">**ストアの論理破損** - ユーザーが期待しない方法でデータが追加、削除、または操作されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-121">**Store logical corruption** - Data is added, deleted, or manipulated in a way that the user doesn't expect.</span></span> <span data-ttu-id="d174c-122">これらのケースは、サード パーティ製のアプリケーションによって発生します。</span><span class="sxs-lookup"><span data-stu-id="d174c-122">These cases are caused by third-party applications.</span></span> <span data-ttu-id="d174c-123">ユーザーが破損と見なすという意味では、通常は破損です。</span><span class="sxs-lookup"><span data-stu-id="d174c-123">It's usually corruption in the sense that the user views it as corruption.</span></span> <span data-ttu-id="d174c-124">Exchange ストアは、論理的破損を引き起こすトランザクションを一連の有効な MAPI 操作として見なします。</span><span class="sxs-lookup"><span data-stu-id="d174c-124">The Exchange store considers the transaction that produced the logical corruption to be a series of valid MAPI operations.</span></span> <span data-ttu-id="d174c-125">Exchange Online のインプレイス [保持](/exchange/security-and-compliance/create-or-remove-in-place-holds) 機能は、ストアの論理的な破損からの保護を提供します (ユーザーまたはアプリケーションによってコンテンツが完全に削除されるのを防ぐため)。</span><span class="sxs-lookup"><span data-stu-id="d174c-125">The [In-Place Hold](/exchange/security-and-compliance/create-or-remove-in-place-holds) features in Exchange Online provides protection from store logical corruption (because it prevents content from being permanently deleted by a user or an application).</span></span> 

<span data-ttu-id="d174c-126">Exchange Online は、ログ インスペクションとログ再生の両方で、レプリケートされたログ ファイルに対していくつかの整合性チェックを実行します。</span><span class="sxs-lookup"><span data-stu-id="d174c-126">Exchange Online performs several consistency checks on replicated log files during both log inspection and log replay.</span></span> <span data-ttu-id="d174c-127">これらの整合性チェックは、物理的な破損がシステムによってレプリケートされるのを防ぐためです。</span><span class="sxs-lookup"><span data-stu-id="d174c-127">These consistency checks prevent physical corruption from being replicated by the system.</span></span> <span data-ttu-id="d174c-128">たとえば、ログ 検査中に、ログ ファイルを検証し、ログ ファイルに記録されたチェックサムがメモリで生成されたチェックサムと一致する検証を行う物理的整合性チェックがあります。</span><span class="sxs-lookup"><span data-stu-id="d174c-128">For example, during log inspection, there is a physical integrity check that verifies the log file and validates that the checksum recorded in the log file matches the checksum generated in memory.</span></span> <span data-ttu-id="d174c-129">さらに、ログ ファイル ヘッダーが調べ、ログ ヘッダーに記録されたログ ファイルの署名がログ ファイルの署名と一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d174c-129">In addition, the log file header is examined to make sure the log file signature recorded in the log header matches that of the log file.</span></span> <span data-ttu-id="d174c-130">ログの再生中に、ログ ファイルはさらに精査されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-130">During log replay, the log file undergoes further scrutiny.</span></span> <span data-ttu-id="d174c-131">たとえば、データベース ヘッダーには、ログ ファイルの署名と比較して一致するログ署名も含まれています。</span><span class="sxs-lookup"><span data-stu-id="d174c-131">For example, the database header also contains the log signature that is compared with the log file's signature to ensure they match.</span></span> 

<span data-ttu-id="d174c-132">Exchange Online でのメールボックス データの破損に対する保護は、Exchange Native Data Protection を使用して実現されます。これは、複数のサーバーおよび複数のデータセンター間でのアプリケーション レベルのレプリケーションと、破損などの理由によりデータが失われるのを防う他の機能を活用する復元戦略です。</span><span class="sxs-lookup"><span data-stu-id="d174c-132">Protection against corruption of mailbox data in Exchange Online is achieved by using Exchange Native Data Protection, a resiliency strategy that leverages application-level replication across multiple servers and multiple datacenters along with other features that help protect data from being lost due to corruption or other reasons.</span></span> <span data-ttu-id="d174c-133">これらの機能には、Microsoft または Exchange Online アプリケーション自体によって管理されるネイティブ機能が含まれます。次に示します。</span><span class="sxs-lookup"><span data-stu-id="d174c-133">These features include native features that are managed by Microsoft or the Exchange Online application itself, such as:</span></span>

- [<span data-ttu-id="d174c-134">データ可用性グループ</span><span class="sxs-lookup"><span data-stu-id="d174c-134">Data Availability Groups</span></span>](/exchange/back-up-email)
- <span data-ttu-id="d174c-135">単一ビットの修正</span><span class="sxs-lookup"><span data-stu-id="d174c-135">Single Bit Correction</span></span> 
- <span data-ttu-id="d174c-136">オンライン データベースのスキャン</span><span class="sxs-lookup"><span data-stu-id="d174c-136">Online Database Scanning</span></span> 
- <span data-ttu-id="d174c-137">失われたフラッシュ検出</span><span class="sxs-lookup"><span data-stu-id="d174c-137">Lost Flush Detection</span></span> 
- <span data-ttu-id="d174c-138">単一ページの復元</span><span class="sxs-lookup"><span data-stu-id="d174c-138">Single Page Restore</span></span> 
- <span data-ttu-id="d174c-139">メールボックス レプリケーション サービス</span><span class="sxs-lookup"><span data-stu-id="d174c-139">Mailbox Replication Service</span></span> 
- <span data-ttu-id="d174c-140">ログ ファイルのチェック</span><span class="sxs-lookup"><span data-stu-id="d174c-140">Log File Checks</span></span> 
- <span data-ttu-id="d174c-141">復元可能なファイル システムでの展開</span><span class="sxs-lookup"><span data-stu-id="d174c-141">Deployment on Resilient File System</span></span> 

<span data-ttu-id="d174c-142">前に示したネイティブ機能の詳細については、ハイパーリンクを選択し、ハイパーリンクのないアイテムの追加情報と詳細については、以下を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d174c-142">For more information on the native features listed previously, select the hyperlinks, and see the following for additional information and for details on items without hyperlinks.</span></span> <span data-ttu-id="d174c-143">これらのネイティブ機能に加えて、Exchange Online には、次のような、お客様が管理できるデータ復元機能も含まれています。</span><span class="sxs-lookup"><span data-stu-id="d174c-143">In addition to these native features, Exchange Online also includes data resiliency features that customers can manage, such as:</span></span> 
- [<span data-ttu-id="d174c-144">単一アイテムの回復 (既定で有効)</span><span class="sxs-lookup"><span data-stu-id="d174c-144">Single Item Recovery (enabled by default)</span></span>](/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [<span data-ttu-id="d174c-145">インプレース保持と訴訟ホールド</span><span class="sxs-lookup"><span data-stu-id="d174c-145">In-Place Hold and Litigation Hold</span></span>](/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [<span data-ttu-id="d174c-146">削除済みアイテムの保持Soft-Deletedメールボックス (両方とも既定で有効)</span><span class="sxs-lookup"><span data-stu-id="d174c-146">Deleted Item Retention and Soft-Deleted Mailboxes (both enabled by default)</span></span>](/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a><span data-ttu-id="d174c-147">データベース可用性グループ</span><span class="sxs-lookup"><span data-stu-id="d174c-147">Database Availability Groups</span></span> 
<span data-ttu-id="d174c-148">Microsoft 365 のすべてのメールボックス データベースは、データベース可用性グループ [(DAG)](/exchange/back-up-email) でホストされ、同じ地域内の地理的に分離されたデータセンターにレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="d174c-148">Every mailbox database in Microsoft 365 is hosted in a [database availability group (DAG)](/exchange/back-up-email) and replicated to geographically separate datacenters within the same region.</span></span> <span data-ttu-id="d174c-149">最も一般的な構成は、4 つのデータセンター内の 4 つのデータベース コピーです。ただし、データセンターが少ない地域があります (データベースはインドの 3 つのデータセンターと、オーストラリアと日本の 2 つのデータセンターにレプリケートされます)。</span><span class="sxs-lookup"><span data-stu-id="d174c-149">The most common configuration is four database copies in four datacenters; however, some regions have fewer datacenters (databases are replicated to three datacenters in India, and two datacenters in Australia and Japan).</span></span> <span data-ttu-id="d174c-150">ただし、すべてのメールボックス データベースには、複数のデータセンターに分散された 4 つのコピーが含まれており、これにより、メールボックス データがソフトウェア、ハードウェア、データセンターの障害から確実に保護されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-150">But in all cases, every mailbox database has four copies that are distributed across multiple datacenters, thereby ensuring that mailbox data is protected from software, hardware, and even datacenter failures.</span></span> 

<span data-ttu-id="d174c-151">これら 4 つのコピーの中で、3 つのコピーが高可用性として構成されています。</span><span class="sxs-lookup"><span data-stu-id="d174c-151">Out of these four copies, three of them are configured as highly available.</span></span> <span data-ttu-id="d174c-152">4 番目のコピーは、時間差データベース [コピーとして構成されます](/Exchange/high-availability/manage-ha/activate-lagged-db-copies)。</span><span class="sxs-lookup"><span data-stu-id="d174c-152">The fourth copy is configured as a [lagged database copy](/Exchange/high-availability/manage-ha/activate-lagged-db-copies).</span></span> <span data-ttu-id="d174c-153">時間差データベース コピーは、個々のメールボックスの回復やメールボックス アイテムの回復を意図したコピーではありません。</span><span class="sxs-lookup"><span data-stu-id="d174c-153">The lagged database copy is not intended for individual mailbox recovery or mailbox item recovery.</span></span> <span data-ttu-id="d174c-154">その目的は、システム全体の壊滅的な論理的破損のまれなイベントに対する回復メカニズムを提供します。</span><span class="sxs-lookup"><span data-stu-id="d174c-154">Its purpose is to provide a recovery mechanism for the rare event of system-wide, catastrophic logical corruption.</span></span> 

<span data-ttu-id="d174c-155">Exchange Online の遅延データベース コピーは、7 日間のログ ファイル再生ラグ タイムで構成されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-155">Lagged database copies in Exchange Online are configured with a seven-day log file replay lag time.</span></span> <span data-ttu-id="d174c-156">さらに、Exchange 再生ラグ マネージャーを有効にすると、ログ ファイルの拡大を自己修復および管理するための遅延データベース コピーを許可するために、遅延コピーの動的ログ ファイル再生を提供できます。</span><span class="sxs-lookup"><span data-stu-id="d174c-156">In addition, the Exchange Replay Lag Manager is enabled to provide dynamic log file play down for lagged copies to allow lagged database copies to self-repair and manage log file growth.</span></span> <span data-ttu-id="d174c-157">Exchange Online では、時間差データベース コピーが使用されます。ただし、これらのコピーが保証されたポイントインタイム バックアップではないと理解することが重要です。</span><span class="sxs-lookup"><span data-stu-id="d174c-157">Although lagged database copies are used in Exchange Online, it is important to understand that they are not a guaranteed point-in-time backup.</span></span> <span data-ttu-id="d174c-158">Exchange Online の時間差データベース コピーの可用性のしきい値は、ディスク障害によりディスクに時間差コピーが含まれるディスクが失われる期間、(自動再生が原因で) 可用性の高いコピーになる期間、および時間差データベース コピーがログ再生キューを再構築する期間が原因で、通常は約 90% です。</span><span class="sxs-lookup"><span data-stu-id="d174c-158">Lagged database copies in Exchange Online have an availability threshold, typically around 90%, due to periods where the disk containing a lagged copy is lost due to disk failure, the lagged copy becoming a highly available copy (due to automatic play down), as well as the periods where the lagged database copy is rebuilding the log replay queue.</span></span> 

## <a name="transport-resilience"></a><span data-ttu-id="d174c-159">トランスポートの復元</span><span class="sxs-lookup"><span data-stu-id="d174c-159">Transport Resilience</span></span> 
<span data-ttu-id="d174c-160">Exchange Online には、シャドウ冗長とセーフティ ネットの 2 つの主なトランスポート復元機能が含まれています。</span><span class="sxs-lookup"><span data-stu-id="d174c-160">Exchange Online includes two primary transport resilience features: Shadow Redundancy and Safety Net.</span></span> <span data-ttu-id="d174c-161">Shadow Redundancy は、メッセージの転送中にメッセージの冗長コピーを保持します。</span><span class="sxs-lookup"><span data-stu-id="d174c-161">Shadow Redundancy keeps a redundant copy of a message while it is in transit.</span></span> <span data-ttu-id="d174c-162">セーフティ ネットは、メッセージが正常に配信された後、メッセージの冗長コピーを保持します。</span><span class="sxs-lookup"><span data-stu-id="d174c-162">Safety Net keeps a redundant copy of a message after the message is successfully delivered.</span></span> 

<span data-ttu-id="d174c-163">シャドウ冗長では、各 Exchange Online トランスポート サーバーは、送信側サーバーへのメッセージの正常な受信を確認する前に、受信した各メッセージのコピーを作成します。</span><span class="sxs-lookup"><span data-stu-id="d174c-163">With Shadow Redundancy, each Exchange Online transport server makes a copy of each message it receives before it acknowledges successfully receiving the message to the sending server.</span></span> <span data-ttu-id="d174c-164">これにより、転送中にトランスポート パイプライン内のすべてのメッセージが冗長になります。</span><span class="sxs-lookup"><span data-stu-id="d174c-164">This makes all messages in the transport pipeline redundant while in transit.</span></span> <span data-ttu-id="d174c-165">Exchange Online が転送中に元のメッセージが失われたと判断した場合、メッセージの冗長コピーが再提供されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-165">If Exchange Online determines the original message was lost in transit, a redundant copy of the message is redelivered.</span></span> 

<span data-ttu-id="d174c-166">セーフティ ネットは、メールボックス サーバー上のトランスポート サービスに関連付けられているトランスポート キューです。</span><span class="sxs-lookup"><span data-stu-id="d174c-166">Safety Net is a transport queue that is associated with the Transport service on a Mailbox server.</span></span> <span data-ttu-id="d174c-167">このキューにより、サーバーによって正常に処理されたメッセージのコピーが保存されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-167">This queue stores copies of messages that were successfully processed by the server.</span></span> <span data-ttu-id="d174c-168">メールボックス データベースまたはサーバーの障害がメールボックス データベースの古いコピーをアクティブ化する必要がある場合、セーフティ ネット キュー内のメッセージは、メールボックス データベースの新しいアクティブ コピーに自動的に再送信されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-168">When a mailbox database or server failure requires activating an out-of-date copy of the mailbox database, messages in the Safety Net queue are automatically resubmitted to the new active copy of the mailbox database.</span></span> <span data-ttu-id="d174c-169">セーフティ ネットも冗長化され、単一障害点としてトランスポートが排除されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-169">Safety Net is also redundant, thereby eliminating transport as a single point of failure.</span></span> <span data-ttu-id="d174c-170">プライマリ セーフティ ネットとシャドウ セーフティ ネットの概念を使用します。プライマリ セーフティ ネットが 12 時間以上使用できない場合、再送信要求はシャドウ再送信要求になり、メッセージはシャドウ セーフティ ネットから再提供されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-170">It uses the concept of a Primary Safety Net and a Shadow Safety Net wherein if the Primary Safety Net is unavailable for more than 12 hours, resubmit requests become shadow resubmit requests, and messages are redelivered from the Shadow Safety Net.</span></span>

<span data-ttu-id="d174c-171">セーフティ ネットからのメッセージの再送信は、DAG とメールボックス データベース コピーを管理する Microsoft Exchange Replication サービスの Active Manager コンポーネントによって自動的に開始されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-171">Message resubmissions from Safety Net are automatically initiated by the Active Manager component of the Microsoft Exchange Replication service that manages DAGs and mailbox database copies.</span></span> <span data-ttu-id="d174c-172">セーフティ ネットからメッセージを再送信するには、手動で操作する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="d174c-172">No manual actions are required to resubmit messages from Safety Net.</span></span> 

## <a name="single-bit-correction"></a><span data-ttu-id="d174c-173">単一ビットの修正</span><span class="sxs-lookup"><span data-stu-id="d174c-173">Single Bit Correction</span></span> 
<span data-ttu-id="d174c-174">ESE には、ハードウェア エラー (および物理的な破損を表す) の結果である単一ビット CRC エラー (シングル ビット フリップとも呼ばれる) を検出して解決するメカニズムが含まれています。</span><span class="sxs-lookup"><span data-stu-id="d174c-174">ESE includes a mechanism to detect and resolve single-bit CRC errors (also known as single-bit flips) that are the result of hardware errors (and as such they represent physical corruption).</span></span> <span data-ttu-id="d174c-175">これらのエラーが発生すると、ESE は自動的にエラーを修正し、イベント ログにイベントを記録します。</span><span class="sxs-lookup"><span data-stu-id="d174c-175">When these errors occur, ESE automatically corrects them and logs an event in the event log.</span></span> 

## <a name="online-database-scanning"></a><span data-ttu-id="d174c-176">オンライン データベースのスキャン</span><span class="sxs-lookup"><span data-stu-id="d174c-176">Online Database Scanning</span></span> 
<span data-ttu-id="d174c-177">オンライン データベース スキャン (データベース チェックの *合計とも呼* ばれる) は、ESE がデータベース整合性チェッカーを使用して各ページを読み取り、ページの破損を確認するプロセスです。</span><span class="sxs-lookup"><span data-stu-id="d174c-177">Online database scanning (also known as *database check summing*) is the process where an ESE uses a database consistency checker to read each page and check for page corruption.</span></span> <span data-ttu-id="d174c-178">主な目的は、トランザクション操作によって検出されない可能性のある物理的な破損と失われたフラッシュを検出します。</span><span class="sxs-lookup"><span data-stu-id="d174c-178">The primary purpose is to detect physical corruption and lost flushes that may not be getting detected by transactional operations.</span></span> <span data-ttu-id="d174c-179">データベース スキャンでは、ストア後のクラッシュ操作も実行されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-179">Database scanning also performs post-store crash operations.</span></span> <span data-ttu-id="d174c-180">クラッシュにより領域が漏洩する可能性があります。オンライン データベースのスキャンでは、失われた領域を検出して回復します。</span><span class="sxs-lookup"><span data-stu-id="d174c-180">Space can be leaked due to crashes, and online database scanning finds and recovers lost space.</span></span> <span data-ttu-id="d174c-181">システムは、すべてのデータベースが 7 日に 1 回完全にスキャンされるという期待を持って設計されています。</span><span class="sxs-lookup"><span data-stu-id="d174c-181">The system is designed with the expectation that every database is fully scanned once every seven days.</span></span> 

## <a name="lost-flush-detection"></a><span data-ttu-id="d174c-182">失われたフラッシュ検出</span><span class="sxs-lookup"><span data-stu-id="d174c-182">Lost Flush Detection</span></span> 
<span data-ttu-id="d174c-183">フラッシュが失われたのは、完了として返されたディスク サブシステム/オペレーティング システムが実際にディスクに書き込まれたか、間違った場所に書き込まれたデータベース書き込み操作である場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="d174c-183">A lost flush occurs when a database write operation that the disk subsystem/operating system returned as completed did not actually get written to disk, or was written in the wrong location.</span></span> <span data-ttu-id="d174c-184">フラッシュが失われた場合、データベースの論理的な破損が発生する可能性があります。そのため、失われたフラッシュがデータの失われを防ぐため、ESE には失われたフラッシュ検出メカニズムが含まれています。</span><span class="sxs-lookup"><span data-stu-id="d174c-184">Lost flush incidents can result in database logical corruption, so to prevent lost flushes from resulting in lost data, ESE includes a lost flush detection mechanism.</span></span> <span data-ttu-id="d174c-185">データベース ページがパッシブ コピーに書き込まれると、アクティブ コピーのフラッシュが失われた場合にチェックが実行されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-185">As database pages are written to passive copies, a check is performed for lost flushes on the active copy.</span></span> <span data-ttu-id="d174c-186">フラッシュが失われた場合、ESE はページの修正プロセスを使用してプロセスを修復できます。</span><span class="sxs-lookup"><span data-stu-id="d174c-186">If a lost flush is detected, ESE can repair the process using a page patching process.</span></span> 

## <a name="single-page-restore"></a><span data-ttu-id="d174c-187">単一ページの復元</span><span class="sxs-lookup"><span data-stu-id="d174c-187">Single Page Restore</span></span> 
<span data-ttu-id="d174c-188">単一ページの復元 (ページの修正プログラムとも呼ばれる) は、破損したデータベース ページが正常なレプリカからの正常なコピーに置き換えられる自動プロセスです。</span><span class="sxs-lookup"><span data-stu-id="d174c-188">Single page restore, also known as *page patching*, is an automatic process where corrupt database pages are replaced by healthy copies from a healthy replica.</span></span> <span data-ttu-id="d174c-189">破損したページの修復プロセスは、データベース コピーがアクティブかパッシブかによって異なります。</span><span class="sxs-lookup"><span data-stu-id="d174c-189">The repair process for a corrupt page depends on whether the database copy is active or passive.</span></span> <span data-ttu-id="d174c-190">アクティブなデータベース コピーで破損したページが検出された場合、コピーするページが最新の状態である場合は、そのレプリカの 1 つからページをコピーできます。</span><span class="sxs-lookup"><span data-stu-id="d174c-190">When an active database copy encounters a corrupted page, it can copy a page from one of its replicas, provided the page it copies is up to date.</span></span> <span data-ttu-id="d174c-191">このプロセスは、メールボックス データベースレプリケーションの基礎であるログ ストリームにページの要求を入れて実行します。</span><span class="sxs-lookup"><span data-stu-id="d174c-191">This process is accomplished by putting a request for the page into the log stream, which is the basis of mailbox database replication.</span></span> <span data-ttu-id="d174c-192">レプリカはページ要求を検出するとすぐに、要求するデータベース コピーにページのコピーを送信して応答します。</span><span class="sxs-lookup"><span data-stu-id="d174c-192">As soon as a replica encounters the page request, it responds by sending a copy of the page to the requesting database copy.</span></span> <span data-ttu-id="d174c-193">単一ページの復元では、レプリカが現在オフラインである場合でも、アクティブなユーザーがレプリカからページを要求するための非同期通信メカニズムも提供します。</span><span class="sxs-lookup"><span data-stu-id="d174c-193">Single page restore also provides an asynchronous communication mechanism for the active to request a page from replicas, even if the replicas are currently offline.</span></span> 

<span data-ttu-id="d174c-194">これらのコピーは常にアクティブ コピーの背後にあるため、データベース コピーの時間差を含むパッシブ データベース コピーが破損した場合、アクティブ コピーからパッシブ コピーに任意のページをコピーしても安全です。</span><span class="sxs-lookup"><span data-stu-id="d174c-194">In case of corruption in a passive database copy, including a lagged database copy, because these copies are always behind their active copy, it is always safe to copy any page from the active copy to a passive copy.</span></span> <span data-ttu-id="d174c-195">パッシブ データベース コピーは、性質上高可用性なので、ページの修正プロセス中はログの再生は中断されますが、ログ コピーは続行されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-195">A passive database copy is by nature highly available, so during the page patching process, log replaying is suspended, but log copying continues.</span></span> <span data-ttu-id="d174c-196">パッシブ データベース コピーは、破損したページのコピーをアクティブ コピーから取得し、必要なログ生成の最大要件を満たすログ ファイルがコピーおよび検査されるまで待機し、破損したページにパッチを適用します。</span><span class="sxs-lookup"><span data-stu-id="d174c-196">The passive database copy retrieves a copy of the corrupted page from the active copy, waits until the log file that meets the maximum required log generation requirement is copied and inspected, and then patches the corrupt page.</span></span> <span data-ttu-id="d174c-197">ページにパッチが適用されると、ログ再生が再開されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-197">Once the page has been patched, log replay resumes.</span></span> <span data-ttu-id="d174c-198">このプロセスは、時間差データベース コピーでも同じですが、更新可能な状態を達成するために必要なすべてのログ ファイルが最初に再生されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-198">The process is the same for the lagged database copy, except that the lagged database first replays all log files that are necessary to achieve a patchable state.</span></span> 

## <a name="mailbox-replication-service"></a><span data-ttu-id="d174c-199">メールボックス レプリケーション サービス</span><span class="sxs-lookup"><span data-stu-id="d174c-199">Mailbox Replication Service</span></span> 
<span data-ttu-id="d174c-200">メールボックスの移動は、大規模なメール サービスを管理する重要な部分です。</span><span class="sxs-lookup"><span data-stu-id="d174c-200">Moving mailboxes is a key part of managing a large-scale email service.</span></span> <span data-ttu-id="d174c-201">常に更新されたテクノロジとハードウェアとバージョンのアップグレードに対処するために、堅牢で調整されたシステムを使用して、エンジニアがメールボックスをユーザーに対して透過的に移動しながら (プロセス全体を通じてオンラインに保つことによって) この作業を実行できるシステムが重要であり、メールボックスの規模が大きくなるとプロセスが正常にスケールアップします。</span><span class="sxs-lookup"><span data-stu-id="d174c-201">There are always updated technologies and hardware and version upgrades to deal with, so having a robust, throttled system that enables our engineers to accomplish this work while keeping the mailbox moves transparent to users (by making sure they stay online throughout the process) is key and making sure that the process scales up gracefully as mailboxes get larger and larger.</span></span> 

<span data-ttu-id="d174c-202">Exchange メールボックス レプリケーション サービス (MRS) は、データベース間でメールボックスを移動する責任があります。</span><span class="sxs-lookup"><span data-stu-id="d174c-202">The Exchange Mailbox Replication Service (MRS) is responsible for moving mailboxes between databases.</span></span> <span data-ttu-id="d174c-203">移動中、MRS はメールボックス内のすべてのアイテムに対して整合性チェックを実行します。</span><span class="sxs-lookup"><span data-stu-id="d174c-203">During the move, MRS performs a consistency check on all items within the mailbox.</span></span> <span data-ttu-id="d174c-204">一貫性の問題が見つかった場合、MRS は問題を修正するか、破損したアイテムをスキップしてメールボックスから破損を削除します。</span><span class="sxs-lookup"><span data-stu-id="d174c-204">If a consistency issue is found, MRS will either correct the problem, or skip the corrupted items, thereby removing the corruption from the mailbox.</span></span> 

<span data-ttu-id="d174c-205">MRS は Exchange Online のコンポーネントなので、将来検出される新しい形式の破損に対処するためにコードを変更できます。</span><span class="sxs-lookup"><span data-stu-id="d174c-205">Because MRS is a component of Exchange Online, we can make changes in its code to address new forms of corruption that are detected in the future.</span></span> <span data-ttu-id="d174c-206">たとえば、MRS が修正できない一貫性の問題が検出された場合は、破損を分析し、MRS コードを変更し、不整合を修正できます (方法がわかっている場合)。</span><span class="sxs-lookup"><span data-stu-id="d174c-206">For example, if we detect a consistency issue that MRS is not able to fix, we can analyze the corruption, change the MRS code and correct the inconsistency (if we understand how to).</span></span> 

## <a name="log-file-checks"></a><span data-ttu-id="d174c-207">ログ ファイルのチェック</span><span class="sxs-lookup"><span data-stu-id="d174c-207">Log File Checks</span></span> 
<span data-ttu-id="d174c-208">Exchange データベースによって生成されたトランザクション ログ ファイルはすべて、いくつかの形式の整合性チェックを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="d174c-208">All transaction log files generated by an Exchange database undergo several forms of consistency checks.</span></span> <span data-ttu-id="d174c-209">ログ ファイルが作成されると、最初に行われるのはビット パターンが書き込まれた後、一連のログ書き込みを実行することです。</span><span class="sxs-lookup"><span data-stu-id="d174c-209">When a log file is created, the first thing done is a bit pattern is written and then a series of log writes is performed.</span></span> <span data-ttu-id="d174c-210">この構造により、Exchange Online は一連のチェック (フラッシュ、CRC、その他のチェックが失われた) を実行して、書き込まれた各ログ ファイルを検証し、レプリケート時に再度検証できます。</span><span class="sxs-lookup"><span data-stu-id="d174c-210">This structure enables Exchange Online to execute a series of checks (lost flush, CRC, and other checks) to validate each log file as it is written, and again as it is replicated.</span></span> 

## <a name="deployment-on-resilient-file-system"></a><span data-ttu-id="d174c-211">復元可能なファイル システムでの展開</span><span class="sxs-lookup"><span data-stu-id="d174c-211">Deployment on Resilient File System</span></span> 
<span data-ttu-id="d174c-212">ファイル システム レベルで破損が発生するのを防ぐために、回復機能を強化するために、Exchange Online は復元ファイル システム (ReFS) パーティションに展開されています。</span><span class="sxs-lookup"><span data-stu-id="d174c-212">To help prevent corruption from occurring at the file system level, Exchange Online is being deployed on Resilient File System (ReFS) partitions to provide improved recovery capabilities.</span></span> <span data-ttu-id="d174c-213">ReFS は、Windows Server 2012以降のファイル システムであり、データの破損に対する回復力を高め、データの可用性と整合性を最大化するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="d174c-213">ReFS is a file system in Windows Server 2012 and later that is designed to be more resilient against data corruption thereby maximizing data availability and integrity.</span></span> <span data-ttu-id="d174c-214">具体的には、ReFS はメタデータの更新方法が改善され、データの保護が強化され、データ破損のケースが減少します。</span><span class="sxs-lookup"><span data-stu-id="d174c-214">Specifically, ReFS brings improvements in the way that metadata is updated which offers better protection for data and reduces data corruption cases.</span></span> <span data-ttu-id="d174c-215">また、チェックサムを使用してファイル データとメタデータの整合性を確認し、データの破損が簡単に見つかり、修復できます。</span><span class="sxs-lookup"><span data-stu-id="d174c-215">It also uses checksums to verify the integrity of file data and metadata ensuring that data corruption is easily found and repaired.</span></span> 

<span data-ttu-id="d174c-216">Exchange Online では、いくつかの ReFS の利点を利用できます。</span><span class="sxs-lookup"><span data-stu-id="d174c-216">Exchange Online takes advantage of several ReFS benefits:</span></span> 
- <span data-ttu-id="d174c-217">データの整合性に対する復元性が高いということは、データ破損インシデントの数が少なさを意味します。</span><span class="sxs-lookup"><span data-stu-id="d174c-217">More resiliency in data integrity means fewer data corruption incidents.</span></span> <span data-ttu-id="d174c-218">破損インシデントの数を減らすと、不要なデータベースの再表示が少なくなっています。</span><span class="sxs-lookup"><span data-stu-id="d174c-218">Reducing the number of corruption incidents means fewer unnecessary database reseeds.</span></span> 
- <span data-ttu-id="d174c-219">メタデータで実行されるチェックサムにより、破損ケースの検出が早く、より早く、より詳細に行われるため、データ ボリュームで灰色のエラーが発生する前に顧客データの破損を修正できます。</span><span class="sxs-lookup"><span data-stu-id="d174c-219">Checksum running on metadata enabling detections of corruption cases sooner and more deterministically, allowing us to fix customer data corruption before grey failures occur on data volumes.</span></span>
- <span data-ttu-id="d174c-220">パフォーマンスに影響を与えることなく、大規模なデータ セット (ペタバイト以上) でうまく機能するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="d174c-220">Designed to work well with large data sets—petabytes and larger—without performance impact</span></span>
- <span data-ttu-id="d174c-221">BitLocker 暗号化など、Exchange Online で使用されるその他の機能のサポート。</span><span class="sxs-lookup"><span data-stu-id="d174c-221">Support for other features used by Exchange Online, such as BitLocker encryption.</span></span> 

<span data-ttu-id="d174c-222">Exchange Online には、他の ReFS 機能も利用できます。</span><span class="sxs-lookup"><span data-stu-id="d174c-222">Exchange Online also benefits from other ReFS features:</span></span> 
- <span data-ttu-id="d174c-223">**整合性 (Integrity Streams)** - ReFS は、通常はデータ損失を引き起こす可能性がある多くの一般的なエラーからデータを保護する方法でデータを格納します。</span><span class="sxs-lookup"><span data-stu-id="d174c-223">**Integrity (Integrity Streams)** - ReFS stores data in a way that protects it from many of the common errors that can normally cause data loss.</span></span> <span data-ttu-id="d174c-224">Microsoft 365 Search は、整合性ストリームを使用して、ファイル コンテンツの初期ディスク破損検出とチェックサムを支援します。</span><span class="sxs-lookup"><span data-stu-id="d174c-224">Microsoft 365 Search uses Integrity Streams to help with early disk corruption detection and checksums of file content.</span></span> <span data-ttu-id="d174c-225">また、"Torn Write" (停電などによって書き込み操作が完了しない場合) によって発生する破損インシデントも軽減されます。</span><span class="sxs-lookup"><span data-stu-id="d174c-225">The feature also reduces corruption incidents caused by “Torn Writes” (when a write operation does not complete due to power outages, etc.).</span></span> 
- <span data-ttu-id="d174c-226">**可用性 (Salvage)** - ReFS はデータの可用性を優先します。</span><span class="sxs-lookup"><span data-stu-id="d174c-226">**Availability (Salvage)** - ReFS prioritizes the availability of data.</span></span> <span data-ttu-id="d174c-227">これまで、ファイル システムは、修復のためにシステムをオフラインにする必要があるデータ破損の影響を受けやすいことが多かった。</span><span class="sxs-lookup"><span data-stu-id="d174c-227">Historically, file systems were often susceptible to data corruption that would require the system to be taken offline for repair.</span></span> <span data-ttu-id="d174c-228">まれですが、破損が発生した場合、ReFS は、ライブ ボリューム上の名前空間から破損したデータを削除し、修復できない破損データによって適切なデータが悪影響を受けずに行われるよう、サルベージ機能を実装します。</span><span class="sxs-lookup"><span data-stu-id="d174c-228">Although rare, if corruption does occur, ReFS implements salvage, a feature that removes the corrupt data from the namespace on a live volume and ensures that good data is not adversely affected by non-repairable corrupt data.</span></span> <span data-ttu-id="d174c-229">Salvage 機能を適用し、データの破損を Exchange Online データベース ボリュームに分離すると、破損と修復アクションの間に、影響を受けないデータベースを破損したボリュームに正常に保持できます。</span><span class="sxs-lookup"><span data-stu-id="d174c-229">Applying the Salvage feature and isolating data corruption to Exchange Online database volumes means that we can keep non-affected databases on a corrupted volume healthy between the time of corruption and repair action.</span></span> <span data-ttu-id="d174c-230">この構造により、通常、このようなディスク破損の問題の影響を受けるデータベースの可用性が向上します。</span><span class="sxs-lookup"><span data-stu-id="d174c-230">This structure increases the availability of databases that would normally be affected by such disk corruption issues.</span></span> 
